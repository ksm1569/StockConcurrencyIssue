# ë™ì‹œì„± ì´ìŠˆì— ëŒ€í•œ ê³ ì°°ê³¼ í•´ê²°ë°©ë²•
### âœ¨ ê°œë°œ ëª©ì  ë° ê°œìš”
ì—¬íƒœê¹Œì§€ ê°œë°œì„ í• ë•Œ ë‹¤ë¥¸íšŒì‚¬ì—ì„œëŠ” ë™ì‹œì„±ì´ìŠˆì— ëŒ€í•´ì„œ

ì–´ë–¤ ë°©ë²•ìœ¼ë¡œ í•´ê²°ì„ í• ê¹Œ ê¶ê¸ˆì¦ì€ ìˆì—ˆìœ¼ë‚˜ ì°¾ì•„ë³´ê±°ë‚˜ í•˜ì§„ ì•Šì•˜ë˜ ê²ƒ ê°™ë‹¤.

ë™ì‹œì„± ê´€ë ¨ ê°•ì˜ì— ë„ì›€ì„ ë°›ì•„ì„œ, ë‚´ìš©ì„ ì´í•´í•˜ê³  ê¹Œë¨¹ì„ ë•Œë¥¼ ëŒ€ë¹„í•˜ì—¬ ì •ë¦¬ í•´ë†“ìœ¼ë ¤ëŠ” ëª©ì ì´ë‹¤. 

- Race Conditionì— ëŒ€í•œ ì •í™•í•œ ì´í•´
- Race Conditionì„ í•´ê²° í•˜ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ë°©ë²• ê³ ì°°

  - Mysqlì˜ Lockê³¼ ì˜ˆì œë¥¼ í†µí•œ ì¥ì , ë‹¨ì , í•œê³„ ì´í•´ì™€ ì¸ì§€
  - Lettuceê³¼ Redisson ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ í•´ê²°í•˜ëŠ” ê¸°ë²•
  - ìœ„ì˜ ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì„ í†µí•´ íšŒì‚¬ ìƒí™©ì— ë§ëŠ” ë°©ë²•ì„ ì„ íƒí•˜ëŠ” íŒë‹¨ë ¥ ê¸°ë¥´ê¸°ê°€ ëª©í‘œ
  
- ë‹¤ì¤‘ ìŠ¤ë ˆë“œì‚¬ìš©ê³¼ í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„± 


### ğŸ”¨ ì‚¬ìš©í•œ í”„ë ˆì„ì›, ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° íˆ´
- IntelliJ Ultimate
- Docker
- JAVA 11
- Spring Boot
- MySQL
- Redis


### âœ Flow
- ì¬ê³ ê´€ë¦¬ í…Œì´ë¸” ìƒì„±(stock_example), ë°ì´í„° ì…ë ¥, ì¬ê³ ê°ì†Œ ë¡œì§ ì¶”ê°€, junitìœ¼ë¡œ ì¬ê³ ê°ì†Œ ë¡œì§ í…ŒìŠ¤íŠ¸ì™„ë£Œ
- ë‹¤ì¤‘ìŠ¤ë ˆë“œë¥¼ ë°œìƒì‹œì¼œ(100ê°œ) ë™ì‹œì„± í…ŒìŠ¤íŠ¸
- ìë°”ì˜ synchronized ì‚¬ìš©í•´ë³´ê¸°

  ì„œë²„ê°€ ì—¬ëŸ¬ëŒ€ ì¼ ê²½ìš° ë¬¸ì œ ë°œìƒ, Transactional íŠ¹ì„±ìƒ ì¶©ëŒ ì¸ì‹
- Mysqlë¡œ í•´ê²°
  
  - Pessimistic Lock
  
    í…Œì´ë¸”ê³¼ ë°ì´í„°ì— ë½ì„ ê±¸ì–´ì„œ ì •í•©ì„±ì„ ë§ì¶”ëŠ” ë°©ë²• - ë°ë“œë½ ì£¼ì˜ í•„ìš”
  - Optimistic Lock
  
    ë²„ì „ì»¬ëŸ¼ì„ ì´ìš©í•´ì„œ update í•˜ê¸°ì „ì— ë²„ì „ì²´í¬ë¥¼ í•œë‹¤
  - Named Lock - ì´ë¦„ì„ ê°€ì§„ metadata Locking ë°©ë²•
  
    ì´ë¦„ì„ ê°€ì§„ ë½ì„ íšë“í•œ í›„ í•´ì œí• ë•Œê¹Œì§€ ë‹¤ë¥¸ ì„¸ì…˜ì€ ì´ lock ì„ íšë“í•  ìˆ˜ ì—†ë„ë¡ í•œë‹¤ (ë³„ë„ í•´ì œí•„ìš”)
 
- ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ í•´ê²°

  - Lettuce
  
    setnx (set if not exist) - key value ê°’ì„ setí• ë•Œ, ê¸°ì¡´ì˜ ê°’ì´ ì—†ì„ë•Œë§Œ setí•œë‹¤
    
    spin lock ë°©ì‹ - ë½ íšë“ í• ë•Œ ê¹Œì§€ ì¬ì‹œë„ í•˜ëŠ” ë¡œì§(retry)ì„ ê°œë°œìê°€ ì§ì ‘êµ¬í˜„í•´ì•¼í•¨
  - Redisson
    
    pub-sub ê¸°ë°˜ lockì œê³µ - ë³„ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„¤ì¹˜ê°€ í•„ìš”í•¨

    ì±„ë„ì„ í•˜ë‚˜ ë‘ì–´ì„œ ìŠ¤ë ˆë“œê°€ ë½ì¢…ë£Œì‹œ ì•Œë ¤ì¤€ë‹¤

  -> ì¬ì‹œë„ê°€ í•„ìš”í•˜ì§€ ì•Šì€ lock ì€ lettuce í™œìš©

  -> ì¬ì‹œë„ê°€ í•„ìš”í•œ ê²½ìš°ì—ëŠ” redisson ë¥¼ í™œìš©

- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦°ìƒ·

  <details>
  <summary>ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼</summary>
  <div markdown="1">
  
    <img width="600" src="https://github.com/ksm1569/DevBlog/assets/34292113/9c9ab9a0-4670-416e-84e0-fee5257bc625">
  
    <img width="600" src="https://github.com/ksm1569/DevBlog/assets/34292113/1e5e39f6-6b19-45cd-9270-3437eb396308">
  
    <img width="600" src="https://github.com/ksm1569/DevBlog/assets/34292113/17071503-2671-4c34-9688-1fd410b0a210">
  
  </div>
  </details>


- ê°ì¢… ì…‹íŒ… ë©”ëª¨
  <details>
  <summary>ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼</summary>
  <div markdown="1">

  ```Shell
    #mysql
  
    docker pull mysql
    docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=1234 --name mysql mysql
    docker ps
  ```

  ```Shell
    #mysql bashë¡œ ì§„ì…í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
  
    docker exec -it mysql bash
    mysql -u root -p
    password ì…ë ¥
    create database stock_example
    use stock_example
  ```
  
  ```Shell
    #redis
  
    docker pull redis
  
    docker run --name myredis -d -p 6379:6379 redis
  ```
  
  ```Shell
    #í„°ë¯¸ë„ í…ŒìŠ¤íŠ¸
  
     1. docker ps ë¡œ redis ì»¨í…Œì´ë„ˆëª… ê°€ì ¸ì˜¨ë‹¤ìŒ
     2. docker exec -it ì»¨í…Œì´ë„ˆëª… redis-cli ì…ë ¥í•˜ë©´ ë‚´ë¶€ë¡œ ì§„ì…ê°€ëŠ¥
     3. ë‚´ë¶€ì—ì„œ ì±„ë„1 êµ¬ë…í•´ë³¸ë‹¤. subscribe ch1
     4. í„°ë¯¸ë„ í•˜ë‚˜ ë” ì—´ì–´ì„œ publish ch1 hi ë¼ëŠ” ë©”ì„¸ì§€ë¥¼ ë³´ë‚´ë³¸ë‹¤
  ```
  
  </div>
  </details>
